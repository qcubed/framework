<?php
	require_once('../qcubed.inc.php');


	// Security check for ALLOW_REMOTE_ADMIN
	// To allow access REGARDLESS of ALLOW_REMOTE_ADMIN, simply remove the line below
	QApplication::CheckRemoteAdmin();

        // Destinations for generated form drafts and panel drafts
            $all_paths = array(
            'form_drafts' => @__DOCROOT__.@__FORM_DRAFTS__ ,
            'panel_drafts' => @__DOCROOT__.@__PANEL_DRAFTS__ ,
            'formbase_class' => @__FORMBASE_CLASSES__ ,
            'model_controls' => @__MODEL__ ,
            'model_gen' => @__MODEL_GEN__ ,
	    'meta_controls' => @__META_CONTROLS__ ,
            'meta_gen' => @__META_CONTROLS_GEN__ ,
            );
	
	$strPageTitle = "QCubed Development Framework - Clean autogenerated draft code ";
	require(__CONFIGURATION__ . '/header.inc.php');
?>
	<h1>Code Cleaner</h1>
	<div class="headerLine"><span><strong>PHP Version:</strong> <?php _p(PHP_VERSION); ?>;&nbsp;&nbsp;<strong>Zend Engine Version:</strong> <?php _p(zend_version()); ?>;&nbsp;&nbsp;<strong>QCubed Version:</strong> <?php _p(QCUBED_VERSION); ?></span></div>

	<div class="headerLine"><span><?php if (array_key_exists('OS', $_SERVER)) printf('<strong>Operating System:</strong> %s;&nbsp;&nbsp;', $_SERVER['OS']); ?><strong>Application:</strong> <?php _p($_SERVER['SERVER_SOFTWARE']); ?>;&nbsp;&nbsp;<strong>Server Name:</strong> <?php _p($_SERVER['SERVER_NAME']); ?></span></div>

	<div class="headerLine"><span><strong>Code Cleaned:</strong> <?php _p(date('l, F j Y, g:i:s A')); ?></span></div>

	<div>
            <?php 
            // preg match file names
            $prreg = '/.*(([Ee]dit)|([Ll]ist)|([Cc]lass)|([Ff]orm)).*\.php$' ;
            $deleted = false;
            $htmlstr = '';
            
            foreach ($all_paths as $allkey => $allvalue){
                chdir($allvalue);
                $files = glob($allvalue.'/*' );
                    foreach ($files as $file ){
                    
                        if ( preg_match( '#'.$prreg.'#' , $file )  ){ 
                             if (is_file($file)) {
                              unlink($file);
                              $deleted = true ;
                              $htmlstr.= $file."</br>" ;
                             }
                        }
                    }
            }
             if ($deleted) { 
                 echo "<p style=\"color:red;\">REMOVED :</p> </br> ".$htmlstr." </br>"; 
            } else { echo "</br>NO files to delete</br>" ;}
            ?>
		
	</div>

<?php require(__CONFIGURATION__ . '/footer.inc.php'); ?>